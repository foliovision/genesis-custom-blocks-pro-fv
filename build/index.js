!function(){var t={184:function(t,e){var s;!function(){"use strict";var n={}.hasOwnProperty;function o(){for(var t=[],e=0;e<arguments.length;e++){var s=arguments[e];if(s){var i=typeof s;if("string"===i||"number"===i)t.push(s);else if(Array.isArray(s)){if(s.length){var a=o.apply(null,s);a&&t.push(a)}}else if("object"===i){if(s.toString!==Object.prototype.toString&&!s.toString.toString().includes("[native code]")){t.push(s.toString());continue}for(var r in s)n.call(s,r)&&s[r]&&t.push(r)}}}return t.join(" ")}t.exports?(o.default=o,t.exports=o):void 0===(s=function(){return o}.apply(e,[]))||(t.exports=s)}()}},e={};function s(n){var o=e[n];if(void 0!==o)return o.exports;var i=e[n]={exports:{}};return t[n](i,i.exports,s),i.exports}s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,{a:e}),e},s.d=function(t,e){for(var n in e)s.o(e,n)&&!s.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},function(){"use strict";var t=window.wp.hooks,e=window.React,n=s(184),o=s.n(n),i=window.wp.i18n,a=window.wp.element,r=window.wp.htmlEntities,u=window.wp.keycodes,l=window.wp.components,p=window.wp.compose,g=window.wp.url,c=window.wp.apiFetch,h=s.n(c);const d=t=>t.stopPropagation();class f extends a.Component{constructor({autocompleteRef:t}){super(...arguments),this.onBlur=this.onBlur.bind(this),this.onFocus=this.onFocus.bind(this),this.onChange=this.onChange.bind(this),this.onKeyDown=this.onKeyDown.bind(this),this.autocompleteRef=t||(0,a.createRef)(),this.inputRef=(0,a.createRef)(),this.updateSuggestions=this.updateSuggestions.bind(this),this.setInputValidity=this.setInputValidity.bind(this),this.suggestionNodes=[],this.state={loading:!1,results:[],showSuggestions:!1,selectedSuggestion:null}}componentDidUpdate(t,e){const{results:s,showSuggestions:n}=this.state,{prevResults:o,prevShowSuggestions:i}=e;s===o&&n===i||n&&(s.length?this.setInputValidity(!0):this.setInputValidity(!1))}componentWillUnmount(){delete this.suggestionsRequest}bindSuggestionNode(t){return e=>{this.suggestionNodes[t]=e}}updateSuggestions(t,e=0){this.setState({loading:!0});const s=h()({path:(0,g.addQueryArgs)("/wp/v2/"+this.props.apiSlug,{search:t,per_page:5})});s.then((n=>{this.suggestionsRequest===s&&(console.log("results",n),this.setState({loading:!1}),n.length?(this.setState({results:n,showSuggestions:!0}),this.props.debouncedSpeak(/* translators: %d: the number of results */
(0,i.sprintf)((0,i._n)("%d result found, use up and down arrow keys to navigate.","%d results found, use up and down arrow keys to navigate.",n.length,"genesis-custom-blocks-pro"),n.length),"assertive"),null===this.state.selectedSuggestion&&""!==this.getInputValue()&&this.setState({selectedSuggestion:0})):e?h()({path:"/wp/v2/"+this.props.apiSlug+"/"+e}).then((t=>{t?(this.setState({results:[t],showSuggestions:!0}),this.props.debouncedSpeak(/* translators: %d: the number of results */
(0,i.sprintf)((0,i._n)("%d result found, use up and down arrow keys to navigate.","%d results found, use up and down arrow keys to navigate.",1,"genesis-custom-blocks-pro"),1),"assertive")):this.setState({results:n,showSuggestions:!1})})):(this.props.debouncedSpeak((0,i.__)("No results.","genesis-custom-blocks-pro"),"assertive"),t||this.setState({results:n})))})).catch((()=>{this.suggestionsRequest===s&&this.setState({loading:!1})})),this.suggestionsRequest=s}setInputValidity(t){this.inputRef.current&&this.inputRef.current.setCustomValidity&&(t?this.inputRef.current.setCustomValidity(""):(
/* translators: %s: the control name */
this.inputRef.current.setCustomValidity((0,i.sprintf)((0,i.__)("Invalid %s","genesis-custom-blocks-pro"),this.props.field.control)),this.inputRef.current.reportValidity()),this.inputRef.current.className=o()("gcb-fetch__input",{"text-control__error":!t}))}onBlur(t){!t.relatedTarget||t.relatedTarget.classList.contains("components-popover__content")||t.relatedTarget.classList.contains("gcb-fetch-input__suggestion")||this.setState({showSuggestions:!1})}onFocus(){this.updateSuggestions(this.getInputValue(),this.getPostId())}onChange(t){const e=t.target.value;this.props.onChange(e),this.updateSuggestions(e)}onKeyDown(t){const{showSuggestions:e,selectedSuggestion:s,results:n,loading:o}=this.state,i=this.getInputValue();if(!e||!n.length||o){switch(t.keyCode){case u.UP:0!==t.target.selectionStart&&(t.stopPropagation(),t.preventDefault(),t.target.setSelectionRange(0,0));break;case u.DOWN:i.length!==t.target.selectionStart&&(t.stopPropagation(),t.preventDefault(),t.target.setSelectionRange(i.length,i.length))}return}const a=this.state.results[this.state.selectedSuggestion];switch(t.keyCode){case u.UP:{t.stopPropagation(),t.preventDefault();const e=s?s-1:n.length-1;this.setState({selectedSuggestion:e});break}case u.DOWN:{t.stopPropagation(),t.preventDefault();const e=null===s||s===n.length-1?0:s+1;this.setState({selectedSuggestion:e});break}case u.ENTER:null!==this.state.selectedSuggestion&&(t.stopPropagation(),this.handlePopoverButton(a),this.inputRef.current.blur())}}handlePopoverButton(t){this.setState({selectedSuggestion:null,showSuggestions:!1}),this.props.onChange(t)}getInputValue(){return this.props.hasOwnProperty("displayValue")?this.props.displayValue:this.props.value}getPostId(){return this.props.hasOwnProperty("value")?this.props.value:0}render(){const{autoFocus:t=!1,className:s,getDisplayValueFromAPI:n,getValueFromAPI:i,field:a,instanceId:u}=this.props,{showSuggestions:p,results:g,selectedSuggestion:c,loading:h}=this.state,f=p&&!!g.length,w=this.getInputValue(),S=n||i;return(0,e.createElement)(l.BaseControl,{label:a.label,id:`fetch-input-${u}`,className:o()("gcb-fetch-input",s),help:a.help},(0,e.createElement)("input",{autoFocus:t,className:"gcb-fetch__input",type:"text","aria-label":a.label,value:w,onBlur:this.onBlur,onFocus:this.onFocus,onChange:this.onChange,onInput:d,onKeyDown:this.onKeyDown,role:"combobox","aria-expanded":p,"aria-autocomplete":"list","aria-controls":`gcb-fetch-input-suggestions-${u}`,"aria-owns":`gcb-fetch-input-suggestions-${u}`,"aria-activedescendant":null!==c?`editor-url-input-suggestion-${u}-${c}`:void 0,ref:this.inputRef,autoComplete:"off",autoCorrect:"off",autoCapitalize:"off",spellCheck:"false"}),!!h&&(0,e.createElement)(l.Spinner,null),f&&(0,e.createElement)(l.Popover,{position:"bottom center",noArrow:!0,focusOnMount:!1,className:o()("gcb-fetch__popover",a.location)},(0,e.createElement)("div",{className:"gcb-fetch-input__suggestions",id:`gcb-fetch-input-suggestions-${u}`,ref:this.autocompleteRef,role:"listbox"},g.map(((t,s)=>{const n=S(t);return!!n&&(0,e.createElement)("button",{key:`gcb-fetch-suggestion-${s}`,role:"option",tabIndex:"-1",id:`gcb-fetch-input-suggestion-${u}-${s}`,ref:this.bindSuggestionNode(s),className:o()("gcb-fetch-input__suggestion",{"is-selected":s===c}),onClick:()=>this.handlePopoverButton(t),"aria-selected":s===c},(0,r.decodeEntities)(n))})))))}}var w=(0,l.withSpokenMessages)((0,p.withInstanceId)(f)),S=t=>{const{field:s,getValue:n,getNameFromAPI:o,onChange:i}=t,a=t=>t&&t.id?parseInt(t.id):0,r={id:0,name:"",...n(t)};return(0,e.createElement)(w,{field:s,apiSlug:s.post_type_rest_slug,value:r.id,displayValue:r.name,getValueFromAPI:a,getDisplayValueFromAPI:o,onChange:t=>{"string"==typeof t?(r.name=t,r.id=0):(r.name=o(t),r.id=a(t)),i(r)}})},m=t=>{const s={...t,getNameFromAPI:t=>t&&t.title&&t.title.rendered?t.title.rendered:""};return(0,e.createElement)(S,{...s})};(0,t.addFilter)("genesisCustomBlocks.controls","genesisCustomBlocksPro/addControls",(t=>(console.log("initialControls",t),{...t,post:m})),99)}()}();